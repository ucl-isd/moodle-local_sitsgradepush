define("local_sitsgradepush/sitsgradepush",["exports","./sitsgradepush_helper","core/notification"],(function(_exports,_sitsgradepush_helper,_notification){var obj;Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_notification=(obj=_notification)&&obj.__esModule?obj:{default:obj};let updatePageIntervalId=null,taskRunning=!1,shouldRefresh=!1;async function updateTasksInfo(courseid,coursemoduleid){let update=await(0,_sitsgradepush_helper.getAssessmentsUpdate)(courseid,coursemoduleid);if(update.success){let assessments=JSON.parse(update.assessments);assessments.length>0?function(assessments){taskRunning=function(assessments){for(let i=0;i<assessments.length;i++)if(null!==assessments[i].task)return!0;return!1}(assessments),taskRunning&&(shouldRefresh=!0);shouldRefresh&&!taskRunning&&(shouldRefresh=!1,location.reload());let pushbutton=document.getElementById("push-all-button");pushbutton?pushbutton.disabled=taskRunning:window.console.log("Push button not found");assessments.forEach((assessment=>{let progressContainer=document.getElementById("progress-container-"+assessment.assessmentmappingid);progressContainer?null===assessment.task?progressContainer.style.display="none":(progressContainer.style.display="block",(0,_sitsgradepush_helper.updateProgressBar)(progressContainer,assessment.task.progress)):window.console.log("Progress container not found for assessment mapping ID: "+assessment.assessmentmappingid)}))}(assessments):clearInterval(updatePageIntervalId)}else clearInterval(updatePageIntervalId),window.console.error(update.message)}_exports.init=(courseid,coursemoduleid)=>{!function(courseid,coursemoduleid){updateTasksInfo(courseid,coursemoduleid),updatePageIntervalId=setInterval((()=>{updateTasksInfo(courseid,coursemoduleid)}),15e3),document.addEventListener("visibilitychange",(function(){"hidden"===document.visibilityState?clearInterval(updatePageIntervalId):(updateTasksInfo(courseid,coursemoduleid),updatePageIntervalId=setInterval((()=>{updateTasksInfo(courseid,coursemoduleid)}),15e3))}))}(courseid,coursemoduleid),function(courseid,coursemoduleid){let confirmTransferButton=document.getElementById("js-transfer-modal-button");if(null===confirmTransferButton)return void window.console.log("Confirmation modal not found.");confirmTransferButton.addEventListener("click",(async function(){let promises=[],mappingtables=document.querySelectorAll(".sitsgradepush-history-table"),total=mappingtables.length-1,count=0;mappingtables.forEach((function(table){let mappingid=table.getAttribute("data-assessmentmappingid"),markscount=table.getAttribute("data-markscount");if(null!==mappingid&&markscount>0){let promise=(0,_sitsgradepush_helper.schedulePushTask)(mappingid).then((function(result){if(result.success)count+=1;else{let errormessageid="error-message-"+mappingid,errormessagerow=document.createElement("div");errormessagerow.setAttribute("id",errormessageid),errormessagerow.setAttribute("class","error-message-row"),errormessagerow.innerHTML='<div class="alert alert-danger" role="alert">'+result.message+"</div>";let currentrow=document.getElementById(errormessageid);null!==currentrow&&currentrow.remove(),table.parentNode.insertBefore(errormessagerow,table)}return result.success})).catch((function(error){window.console.error(error)}));promises.push(promise)}})),await Promise.all(promises),await updateTasksInfo(courseid,coursemoduleid),await _notification.default.addNotification({message:count+" of "+total+" push tasks have been scheduled.",type:count===total?"success":"warning"})}))}(courseid,coursemoduleid)}}));

//# sourceMappingURL=sitsgradepush.min.js.map