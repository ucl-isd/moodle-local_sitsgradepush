define("local_sitsgradepush/select_source",["exports","./table_helper","core/notification","core/modal_events","core/modal_save_cancel","./sitsgradepush_helper","core/str"],(function(_exports,_table_helper,_notification,_modal_events,_modal_save_cancel,_sitsgradepush_helper,_str){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_notification=_interopRequireDefault(_notification),_modal_events=_interopRequireDefault(_modal_events),_modal_save_cancel=_interopRequireDefault(_modal_save_cancel);let extensionInfoPageUrl=null;async function getModalBody(type,name,endDate,mapcode,mabseq,mabname,extensioneligible){const[titleSubtitle,titleMapcode,titleSequence,titleSitsAssessment,titleType,titleName,titleEndDate,titleExtensionsText,titleImportSoraExtension,titleViewGuide,textToMoodleActivity]=await Promise.all([(0,_str.getString)("selectsource:modal:subtitle","local_sitsgradepush"),(0,_str.getString)("selectsource:modal:mapcode","local_sitsgradepush"),(0,_str.getString)("selectsource:modal:sequence","local_sitsgradepush"),(0,_str.getString)("selectsource:modal:sitsassessment","local_sitsgradepush"),(0,_str.getString)("selectsource:modal:type","local_sitsgradepush"),(0,_str.getString)("selectsource:modal:name","local_sitsgradepush"),(0,_str.getString)("selectsource:modal:enddate","local_sitsgradepush"),(0,_str.getString)("selectsource:modal:extensions","local_sitsgradepush"),(0,_str.getString)("selectsource:modal:importextension","local_sitsgradepush"),(0,_str.getString)("selectsource:modal:viewguide","local_sitsgradepush"),(0,_str.getString)("selectsource:modal:tomoodleactivity","local_sitsgradepush")]),extensionSection="1"===extensioneligible?"\n        <th>".concat(titleExtensionsText,"</th>\n    "):"",extensionContent="1"===extensioneligible?'\n        <td>\n            <div class="form-check">\n                <input class="form-check-input" type="checkbox" id="import-sora">\n                <label class="form-check-label" for="import-sora">'.concat(titleImportSoraExtension,'</label>\n            </div>\n            <p>\n                <a href="').concat(extensionInfoPageUrl,'" target="_blank">\n                    ').concat(titleViewGuide,"\n                </a>\n            </p>\n        </td>\n    "):"";return'\n        <div class="modal-body">\n            <p>'.concat(titleSubtitle,'</p>\n\n            <table class="table table-bordered">\n                <thead class="thead-light">\n                    <th>').concat(titleMapcode,"</th>\n                    <th>").concat(titleSequence,"</th>\n                    <th>").concat(titleSitsAssessment,"</th>\n                    ").concat(extensionSection,"\n                </thead>\n                <tr>\n                    <td>").concat(mapcode,"</td>\n                    <td>").concat(mabseq,"</td>\n                    <td>").concat(mabname,"</td>\n                    ").concat(extensionContent,"\n                </tr>\n            </table>\n\n            <p>").concat(textToMoodleActivity,'</p>\n\n            <table class="table table-bordered">\n                <thead class="thead-light">\n                    <th>').concat(titleType,"</th>\n                    <th>").concat(titleName,"</th>\n                    <th>").concat(titleEndDate,"</th>\n                </thead>\n                <tr>\n                    <td>").concat(type,"</td>\n                    <td>").concat(name,"</td>\n                    <td>").concat(endDate,"</td>\n                </tr>\n            </table>\n        </div>")}_exports.init=extensioninfopageurl=>{extensionInfoPageUrl=extensioninfopageurl,(0,_table_helper.tableHelperInit)("existing-activity-table",2,"filterInput");let selectAssessmentButtons=document.querySelectorAll(".select-assessment-button");selectAssessmentButtons&&selectAssessmentButtons.forEach((function(button){button.addEventListener("click",(function(){(async function(button){let mapcode=button.getAttribute("data-mapcode"),mabseq=button.getAttribute("data-mabseq"),mabid=button.getAttribute("data-mabid"),mabname=button.getAttribute("data-mabname"),courseid=button.getAttribute("data-courseid"),sourcetype=button.getAttribute("data-sourcetype"),sourceid=button.getAttribute("data-sourceid"),reassess=button.getAttribute("data-reassess"),partid=button.getAttribute("data-partid"),extensioneligible=button.getAttribute("data-extensioneligible"),currentrow=button.closest("tr"),type=currentrow.getElementsByTagName("td")[0].innerHTML,name=currentrow.getElementsByTagName("td")[1].innerHTML,endDate=currentrow.getElementsByTagName("td")[3].innerHTML;const modal=await _modal_save_cancel.default.create({title:"Confirmation",body:getModalBody(type,name,endDate,mapcode,mabseq,mabname,extensioneligible),large:!0,buttons:{save:"Confirm",cancel:"Cancel"}});await modal.show();const modalRoot=modal.getRoot();modal.getRoot().on(_modal_events.default.save,(()=>{const soraCheckbox=modalRoot.find("#import-sora")[0],extensions=!!soraCheckbox&&soraCheckbox.checked;(0,_sitsgradepush_helper.mapAssessment)(courseid,sourcetype,sourceid,mabid,reassess,extensions,partid).then((result=>{if(result.success){localStorage.setItem("successMessage",result.message);let url="/local/sitsgradepush/dashboard.php?id="+courseid;"1"===reassess&&(url+="&reassess="+reassess),window.location.href=url}else _notification.default.addNotification({message:result.message,type:"error"});return result})).catch((error=>{window.console.error(error)}))}))})(button).then((result=>result)).catch((error=>{_notification.default.addNotification({message:error.message,type:"error"}),window.console.error(error)}))}))}))}}));

//# sourceMappingURL=select_source.min.js.map