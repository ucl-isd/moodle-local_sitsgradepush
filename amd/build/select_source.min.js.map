{"version":3,"file":"select_source.min.js","sources":["../src/select_source.js"],"sourcesContent":["import {tableHelperInit} from './table_helper';\nimport notification from \"core/notification\";\nimport ModalEvents from 'core/modal_events';\nimport ModalSaveCancel from 'core/modal_save_cancel';\nimport {mapAssessment} from './sitsgradepush_helper';\n\nexport const init = () => {\n    // Initialise the table helper.\n    tableHelperInit('existing-activity-table', 2, 'filterInput');\n\n    // Get all the select assessment buttons.\n    let selectAssessmentButtons = document.querySelectorAll('.select-assessment-button');\n\n    if (selectAssessmentButtons) {\n        // Add an event listener to each select assessment button.\n        // When the user clicks on each button, map the assessment to the selected component grade.\n        selectAssessmentButtons.forEach(function(button) {\n            button.addEventListener('click', function() {\n                selectAssessment(button).then(\n                    (result) => {\n                        return result;\n                    }\n                ).catch((error) => {\n                    notification.addNotification({\n                        message: error.message,\n                        type: 'error'\n                    });\n                    window.console.error(error);\n                });\n            });\n        });\n    }\n};\n\n/**\n * Show a modal to confirm the user wants to map the assessment to the selected component grade.\n *\n * @param {HTMLElement} button The select assessment button element.\n * @return {Promise<void>}\n */\nasync function selectAssessment(button) {\n    // Get assessment component data from the button.\n    let mapcode = button.getAttribute('data-mapcode');\n    let mabseq = button.getAttribute('data-mabseq');\n    let mabid = button.getAttribute('data-mabid');\n    let courseid = button.getAttribute('data-courseid');\n    let sourcetype = button.getAttribute('data-sourcetype');\n    let sourceid = button.getAttribute('data-sourceid');\n    let partid = button.getAttribute('data-partid');\n\n    // Find the closest row to the button.\n    let currentrow = button.closest('tr');\n    let type = currentrow.getElementsByTagName('td')[0].innerHTML;\n    let name = currentrow.getElementsByTagName('td')[1].innerHTML;\n    let endDate = currentrow.getElementsByTagName('td')[3].innerHTML;\n\n    const modal = await ModalSaveCancel.create({\n        title: 'Confirmation',\n        body: getModalBody(type, name, endDate, mapcode, mabseq),\n        large: true,\n        buttons: {'save': 'Confirm', 'cancel': 'Cancel'}\n    });\n\n    await modal.show();\n    modal.getRoot().on(ModalEvents.save, () => {\n        mapAssessment(courseid, sourcetype, sourceid, mabid, partid).then(\n            (result) => {\n                if (result.success) {\n                    // Store the success message in localStorage for display on the dashboard page.\n                    localStorage.setItem('successMessage', result.message);\n\n                    // Redirect to the dashboard page.\n                    window.location.href = '/local/sitsgradepush/dashboard.php?id=' + courseid;\n                } else {\n                    notification.addNotification({\n                        message: result.message,\n                        type: 'error'\n                    });\n                }\n                return result;\n            }\n        ).catch((error) => {\n            window.console.error(error);\n        });\n    });\n}\n\n/**\n * Get the modal body.\n *\n * @param {string} type\n * @param {string} name\n * @param {string} endDate\n * @param {string} mapcode\n * @param {string} mabseq\n * @return {string}\n */\nfunction getModalBody(type, name, endDate, mapcode, mabseq) {\n    return `\n    <div class=\"modal-body\">\n      <p>Confirm you want to return marks from:</p>\n      <table class=\"table table-hover table-bordered\">\n        <thead style=\"background-color: lightgrey\">\n          <th>Type</th>\n          <th>Name</th>\n          <th>End Date</th>\n        </thead>\n        <tr>\n          <td>${type}</td>\n          <td>${name}</td>\n          <td>${endDate}</td>\n        </tr>\n      </table>\n      <p>to</p>\n      <table class=\"table table-hover table-bordered\">\n        <thead style=\"background-color: lightgrey\">\n          <th>MAB</th>\n          <th>SEQ</th>\n        </thead>\n        <tr>\n          <td>${mapcode}</td>\n          <td>${mabseq}</td>\n        </tr>\n      </table>\n    </div>`;\n}\n"],"names":["getModalBody","type","name","endDate","mapcode","mabseq","selectAssessmentButtons","document","querySelectorAll","forEach","button","addEventListener","getAttribute","mabid","courseid","sourcetype","sourceid","partid","currentrow","closest","getElementsByTagName","innerHTML","modal","ModalSaveCancel","create","title","body","large","buttons","show","getRoot","on","ModalEvents","save","then","result","success","localStorage","setItem","message","window","location","href","addNotification","catch","error","console","selectAssessment"],"mappings":"ulBAiGSA,aAAaC,KAAMC,KAAMC,QAASC,QAASC,uVAWpCJ,qCACAC,qCACAC,qRAUAC,wCACAC,yEAnHI,uCAEA,0BAA2B,EAAG,mBAG1CC,wBAA0BC,SAASC,iBAAiB,6BAEpDF,yBAGAA,wBAAwBG,SAAQ,SAASC,QACrCA,OAAOC,iBAAiB,SAAS,2BAuBbD,YAExBN,QAAUM,OAAOE,aAAa,gBAC9BP,OAASK,OAAOE,aAAa,eAC7BC,MAAQH,OAAOE,aAAa,cAC5BE,SAAWJ,OAAOE,aAAa,iBAC/BG,WAAaL,OAAOE,aAAa,mBACjCI,SAAWN,OAAOE,aAAa,iBAC/BK,OAASP,OAAOE,aAAa,eAG7BM,WAAaR,OAAOS,QAAQ,MAC5BlB,KAAOiB,WAAWE,qBAAqB,MAAM,GAAGC,UAChDnB,KAAOgB,WAAWE,qBAAqB,MAAM,GAAGC,UAChDlB,QAAUe,WAAWE,qBAAqB,MAAM,GAAGC,gBAEjDC,YAAcC,2BAAgBC,OAAO,CACvCC,MAAO,eACPC,KAAM1B,aAAaC,KAAMC,KAAMC,QAASC,QAASC,QACjDsB,OAAO,EACPC,QAAS,MAAS,iBAAqB,kBAGrCN,MAAMO,OACZP,MAAMQ,UAAUC,GAAGC,sBAAYC,MAAM,6CACnBnB,SAAUC,WAAYC,SAAUH,MAAOI,QAAQiB,MACxDC,SACOA,OAAOC,SAEPC,aAAaC,QAAQ,iBAAkBH,OAAOI,SAG9CC,OAAOC,SAASC,KAAO,yCAA2C5B,gCAErD6B,gBAAgB,CACzBJ,QAASJ,OAAOI,QAChBtC,KAAM,UAGPkC,UAEbS,OAAOC,QACLL,OAAOM,QAAQD,MAAMA,cAhEjBE,CAAiBrC,QAAQwB,MACpBC,QACUA,SAEbS,OAAOC,8BACQF,gBAAgB,CACzBJ,QAASM,MAAMN,QACftC,KAAM,UAEVuC,OAAOM,QAAQD,MAAMA"}