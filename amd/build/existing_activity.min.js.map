{"version":3,"file":"existing_activity.min.js","sources":["../src/existing_activity.js"],"sourcesContent":["import {tableHelperInit} from './table_helper';\nimport notification from \"core/notification\";\nimport ModalFactory from 'core/modal_factory';\nimport ModalEvents from 'core/modal_events';\nimport {mapAssessment} from './sitsgradepush_helper';\n\nexport const init = () => {\n    // Initialise the table helper.\n    tableHelperInit('existing-activity-table', 2, 'filterInput');\n\n    // Get all the select assessment buttons.\n    let selectAssessmentButtons = document.querySelectorAll('.select-assessment-button');\n\n    if (selectAssessmentButtons) {\n        // Add an event listener to each select assessment button.\n        // When the user clicks on each button, map the assessment to the selected component grade.\n        selectAssessmentButtons.forEach(function(button) {\n            button.addEventListener('click', function() {\n                selectAssessment(button).then(\n                    (result) => {\n                        return result;\n                    }\n                ).catch((error) => {\n                    notification.addNotification({\n                        message: error.message,\n                        type: 'error'\n                    });\n                    window.console.error(error);\n                });\n            });\n        });\n    }\n};\n\n/**\n * Show a modal to confirm the user wants to map the assessment to the selected component grade.\n *\n * @param {HTMLElement} button The select assessment button element.\n * @return {Promise<void>}\n */\nasync function selectAssessment(button) {\n    // Get assessment component data from the button.\n    let mapcode = button.getAttribute('data-mapcode');\n    let mabseq = button.getAttribute('data-mabseq');\n    let mabid = button.getAttribute('data-mabid');\n    let courseid = button.getAttribute('data-courseid');\n    let coursemoduleid = button.getAttribute('data-coursemoduleid');\n    let partid = button.getAttribute('data-partid');\n\n    // Find the closest row to the button.\n    let currentrow = button.closest('tr');\n    let type = currentrow.getElementsByTagName('td')[0].innerHTML;\n    let name = currentrow.getElementsByTagName('td')[1].innerHTML;\n    let endDate = currentrow.getElementsByTagName('td')[3].innerHTML;\n\n    let modal = await ModalFactory.create({\n        type: ModalFactory.types.SAVE_CANCEL,\n        title: 'Confirmation',\n        body: getModalBody(type, name, endDate, mapcode, mabseq),\n        large: true,\n        buttons: {'save': 'Confirm', 'cancel': 'Cancel'}\n    });\n\n    await modal.show();\n    modal.getRoot().on(ModalEvents.save, () => {\n        mapAssessment(courseid, coursemoduleid, mabid, partid).then(\n            (result) => {\n                if (result.success) {\n                    // Store the success message in localStorage for display on the dashboard page.\n                    localStorage.setItem('successMessage', result.message);\n\n                    // Redirect to the dashboard page.\n                    window.location.href = '/local/sitsgradepush/dashboard.php?id=' + courseid;\n                } else {\n                    notification.addNotification({\n                        message: result.message,\n                        type: 'error'\n                    });\n                }\n                return result;\n            }\n        ).catch((error) => {\n            window.console.error(error);\n        });\n    });\n}\n\n/**\n * Get the modal body.\n *\n * @param {string} type\n * @param {string} name\n * @param {string} endDate\n * @param {string} mapcode\n * @param {string} mabseq\n * @return {string}\n */\nfunction getModalBody(type, name, endDate, mapcode, mabseq) {\n    return `\n    <div class=\"modal-body\">\n      <p>Confirm you want to return marks from:</p>\n      <table class=\"table table-hover table-bordered\">\n        <thead style=\"background-color: lightgrey\">\n          <th>Type</th>\n          <th>Name</th>\n          <th>End Date</th>\n        </thead>\n        <tr>\n          <td>${type}</td>\n          <td>${name}</td>\n          <td>${endDate}</td>\n        </tr>\n      </table>\n      <p>to</p>\n      <table class=\"table table-hover table-bordered\">\n        <thead style=\"background-color: lightgrey\">\n          <th>MAB</th>\n          <th>SEQ</th>\n        </thead>\n        <tr>\n          <td>${mapcode}</td>\n          <td>${mabseq}</td>\n        </tr>\n      </table>\n    </div>`;\n}\n"],"names":["getModalBody","type","name","endDate","mapcode","mabseq","selectAssessmentButtons","document","querySelectorAll","forEach","button","addEventListener","getAttribute","mabid","courseid","coursemoduleid","partid","currentrow","closest","getElementsByTagName","innerHTML","modal","ModalFactory","create","types","SAVE_CANCEL","title","body","large","buttons","show","getRoot","on","ModalEvents","save","then","result","success","localStorage","setItem","message","window","location","href","addNotification","catch","error","console","selectAssessment"],"mappings":"2kBAiGSA,aAAaC,KAAMC,KAAMC,QAASC,QAASC,uVAWpCJ,qCACAC,qCACAC,qRAUAC,wCACAC,yEAnHI,uCAEA,0BAA2B,EAAG,mBAG1CC,wBAA0BC,SAASC,iBAAiB,6BAEpDF,yBAGAA,wBAAwBG,SAAQ,SAASC,QACrCA,OAAOC,iBAAiB,SAAS,2BAuBbD,YAExBN,QAAUM,OAAOE,aAAa,gBAC9BP,OAASK,OAAOE,aAAa,eAC7BC,MAAQH,OAAOE,aAAa,cAC5BE,SAAWJ,OAAOE,aAAa,iBAC/BG,eAAiBL,OAAOE,aAAa,uBACrCI,OAASN,OAAOE,aAAa,eAG7BK,WAAaP,OAAOQ,QAAQ,MAC5BjB,KAAOgB,WAAWE,qBAAqB,MAAM,GAAGC,UAChDlB,KAAOe,WAAWE,qBAAqB,MAAM,GAAGC,UAChDjB,QAAUc,WAAWE,qBAAqB,MAAM,GAAGC,UAEnDC,YAAcC,uBAAaC,OAAO,CAClCtB,KAAMqB,uBAAaE,MAAMC,YACzBC,MAAO,eACPC,KAAM3B,aAAaC,KAAMC,KAAMC,QAASC,QAASC,QACjDuB,OAAO,EACPC,QAAS,MAAS,iBAAqB,kBAGrCR,MAAMS,OACZT,MAAMU,UAAUC,GAAGC,sBAAYC,MAAM,6CACnBpB,SAAUC,eAAgBF,MAAOG,QAAQmB,MAClDC,SACOA,OAAOC,SAEPC,aAAaC,QAAQ,iBAAkBH,OAAOI,SAG9CC,OAAOC,SAASC,KAAO,yCAA2C7B,gCAErD8B,gBAAgB,CACzBJ,QAASJ,OAAOI,QAChBvC,KAAM,UAGPmC,UAEbS,OAAOC,QACLL,OAAOM,QAAQD,MAAMA,cAhEjBE,CAAiBtC,QAAQyB,MACpBC,QACUA,SAEbS,OAAOC,8BACQF,gBAAgB,CACzBJ,QAASM,MAAMN,QACfvC,KAAM,UAEVwC,OAAOM,QAAQD,MAAMA"}