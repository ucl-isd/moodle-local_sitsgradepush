{"version":3,"file":"sitsgradepush.min.js","sources":["../src/sitsgradepush.js"],"sourcesContent":["import {schedulePushTask} from \"./push_tasks\";\nimport notification from 'core/notification';\n\nexport const init = (coursemoduleid, mappingids) => {\n    // Get the push button.\n    let pushbuton = document.getElementById('local_sitsgradepush_pushbutton_async');\n\n    // Exit if the push button is not found.\n    if (pushbuton === null) {\n        return;\n    }\n\n    let promises = [];\n\n    // Schedule a push task for each assessment mapping.\n    pushbuton.addEventListener('click', async(e) => {\n        e.preventDefault();\n\n        // Number of assessment mappings.\n        let total = mappingids.length;\n        let count = 0;\n\n        // Schedule a task to push grades to SITS for each assessment mapping.\n        mappingids.forEach(function(mappingid) {\n            let promise = schedulePushTask(mappingid)\n                .then(function(result) {\n                    let taskstatus = document.getElementById('taskstatus-' + mappingid);\n                    if (result.success) {\n                        count = count + 1;\n                        taskstatus.innerHTML = '<i class=\"fa-solid fa-hourglass-start\"></i> ' + result.status;\n                    } else {\n                        // Create an error message row.\n                        let errormessagerow = document.createElement(\"tr\");\n                        errormessagerow.setAttribute(\"class\", \"error-message-row\");\n                        errormessagerow.innerHTML =\n                            '<td colspan=\"6>\">' +\n                            '<div class=\"alert alert-danger\" role=\"alert\">' + result.message + '</div>' +\n                            '</td>';\n\n                        // Find the closest row to the assessment mapping.\n                        let currentrow = taskstatus.closest(\"tr\");\n\n                        // Remove the existing error message row if it exists.\n                        if (currentrow.nextElementSibling !== null &&\n                            currentrow.nextElementSibling.classList.contains(\"error-message-row\")) {\n                            currentrow.nextElementSibling.remove();\n                        }\n\n                        // Insert the error message row for the assessment mapping.\n                        currentrow.insertAdjacentElement(\"afterend\", errormessagerow);\n                    }\n                    return result.success;\n                })\n                .catch(function(error) {\n                    window.console.error(error);\n                });\n\n            promises.push(promise);\n        });\n\n        // Wait for all the push tasks to be scheduled.\n        await Promise.all(promises);\n\n        // Display a notification.\n        notification.addNotification({\n            message: count + ' of ' + total + ' push tasks have been scheduled.',\n            type: (count === total) ? 'success' : 'warning'\n        });\n    });\n};\n"],"names":["coursemoduleid","mappingids","pushbuton","document","getElementById","promises","addEventListener","async","e","preventDefault","total","length","count","forEach","mappingid","promise","then","result","taskstatus","success","innerHTML","status","errormessagerow","createElement","setAttribute","message","currentrow","closest","nextElementSibling","classList","contains","remove","insertAdjacentElement","catch","error","window","console","push","Promise","all","addNotification","type"],"mappings":"+SAGoB,CAACA,eAAgBC,kBAE7BC,UAAYC,SAASC,eAAe,2CAGtB,OAAdF,qBAIAG,SAAW,GAGfH,UAAUI,iBAAiB,SAASC,MAAAA,IAChCC,EAAEC,qBAGEC,MAAQT,WAAWU,OACnBC,MAAQ,EAGZX,WAAWY,SAAQ,SAASC,eACpBC,SAAU,gCAAiBD,WAC1BE,MAAK,SAASC,YACPC,WAAaf,SAASC,eAAe,cAAgBU,cACrDG,OAAOE,QACPP,OAAgB,EAChBM,WAAWE,UAAY,+CAAiDH,OAAOI,WAC5E,KAECC,gBAAkBnB,SAASoB,cAAc,MAC7CD,gBAAgBE,aAAa,QAAS,qBACtCF,gBAAgBF,UACZ,iEACkDH,OAAOQ,QADzD,kBAKAC,WAAaR,WAAWS,QAAQ,MAGE,OAAlCD,WAAWE,oBACXF,WAAWE,mBAAmBC,UAAUC,SAAS,sBACjDJ,WAAWE,mBAAmBG,SAIlCL,WAAWM,sBAAsB,WAAYV,wBAE1CL,OAAOE,WAEjBc,OAAM,SAASC,OACZC,OAAOC,QAAQF,MAAMA,UAG7B7B,SAASgC,KAAKtB,kBAIZuB,QAAQC,IAAIlC,gCAGLmC,gBAAgB,CACzBf,QAASb,MAAQ,OAASF,MAAQ,mCAClC+B,KAAO7B,QAAUF,MAAS,UAAY"}